<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="google-site-verification"
    content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI"
  />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <meta name="description" content="cody1991的博客" />
  <meta name="keywords" content="cody1991, blog" />
  <meta name="theme-color" content="#000000" />

  <!-- Open Graph -->
  <meta
    property="og:title"
    content="深入理解 webpack - cody1991的博客 | cody1991 Blog"
  />
  
  <meta property="og:type" content="article" />
  <meta
    property="og:description"
    content="入门
"
  />
   <meta property="article:published_time" content="2021-04-24T00:00:00Z">   
  <meta property="article:tag" content="webpack" />
   
  <meta property="og:image" content="https://cody1991.github.io/Bloghttps://cody1991.github.io/Blog/img/cody1991.jpeg" />
  <meta property="og:url" content="https://cody1991.github.io/Blog/2021/04/24/webpack-demo/" />
  <meta property="og:site_name" content="cody1991的博客 | cody1991 Blog" />

  <title>
    深入理解 webpack - cody1991的博客 | cody1991 Blog
  </title>

  <!-- Web App Manifest -->
  <link rel="manifest" href="/Blog/pwa/manifest.json" />

  <!-- Favicon -->
  <link rel="shortcut icon" href="/Blog/img/favicon.ico" />

  <!-- Canonical URL -->
  <link
    rel="canonical"
    href="https://cody1991.github.io/Blog/Blog/2021/04/24/webpack-demo/"
  />

  <!-- Bootstrap Core CSS -->
  <link
    rel="stylesheet"
    href="//cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.2/css/bootstrap.min.css"
  />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/Blog/css/hux-blog.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/Blog/css/codytang-blog.css">

  <!-- Custom Fonts -->
  <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
  <!-- Hux change font-awesome CDN to qiniu -->
  <link
    href="//cdn.bootcdn.net/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css"
    rel="stylesheet"
    type="text/css"
  />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- ga & ba script hoook -->
  <script></script>

  <script>
    (function () {
      var src = '//cdn.jsdelivr.net/npm/eruda';
      if (
        !/eruda=true/.test(window.location) &&
        localStorage.getItem('active-eruda') != 'true'
      )
        return;
      document.write('<scr' + 'ipt src="' + src + '"></scr' + 'ipt>');
      document.write('<scr' + 'ipt>eruda.init();</scr' + 'ipt>');
    })();
  </script>
</head>


  <!-- hack iOS CSS :active style -->
  <body ontouchstart="">
    <!-- Navigation -->

    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/Blog/">cody1991</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div id="huxblog_navbar">
                <div class="navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="/Blog/">Home</a>
                        </li>
                        
                        
                        
                        
                        <li>
                            <a href="/Blog/about/">About</a>
                        </li>
                        
                        
                        
                        <li>
                            <a href="/Blog/archive/">Archive</a>
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <li class="search-icon">
                            <a href="javascript:void(0)">
                                <i class="fa fa-search"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <script>
        // Drop Bootstarp low-performance Navbar
        // Use customize navbar with high-quality material design animation
        // in high-perf jank-free CSS3 implementation
        var $body = document.body;
        var $toggle = document.querySelector('.navbar-toggle');
        var $navbar = document.querySelector('#huxblog_navbar');
        var $collapse = document.querySelector('.navbar-collapse');

        var __HuxNav__ = {
            close: function () {
                $navbar.className = " ";
                // wait until animation end.
                setTimeout(function () {
                    // prevent frequently toggle
                    if ($navbar.className.indexOf('in') < 0) {
                        $collapse.style.height = "0px"
                    }
                }, 400)
            },
            open: function () {
                $collapse.style.height = "auto"
                $navbar.className += " in";
            }
        }

        // Bind Event
        $toggle.addEventListener('click', function (e) {
            if ($navbar.className.indexOf('in') > 0) {
                __HuxNav__.close()
            } else {
                __HuxNav__.open()
            }
        })

        /**
         * Since Fastclick is used to delegate 'touchstart' globally
         * to hack 300ms delay in iOS by performing a fake 'click',
         * Using 'e.stopPropagation' to stop 'touchstart' event from 
         * $toggle/$collapse will break global delegation.
         * 
         * Instead, we use a 'e.target' filter to prevent handler
         * added to document close HuxNav.  
         *
         * Also, we use 'click' instead of 'touchstart' as compromise
         */
        document.addEventListener('click', function (e) {
            if (e.target == $toggle) return;
            if (e.target.className == 'icon-bar') return;
            __HuxNav__.close();
        })
    </script> <!-- Search -->
<div class="search-page">
  <div class="search-icon-close-container">
    <span class="search-icon-close">
      <i class="fa fa-chevron-down"></i>
    </span>
  </div>
  <div class="search-main container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <form></form>
        <input type="text" id="search-input" placeholder="$ grep...">
        </form>
        <div id="search-results" class="mini-post-list"></div>
      </div>
    </div>
  </div>
</div> <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/Blog/img/home-bg.jpg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/Blog/img/home-bg.jpg');
        background: ;
    }

    
</style>

<header class="intro-header" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/Blog/archive/?tag=webpack" title="webpack">webpack</a>
                        
                    </div>
                    <h1>深入理解 webpack</h1>
                    
                    <h2 class="subheading"></h2>
                    <span class="meta">Posted by cody1991 on April 24, 2021</span>
                </div>
            </div>
        </div>
    </div>
</header>






<!-- Post Content -->
<article>
  <div class="container">
    <div class="row">
      <!-- Post Container -->
      <div
        class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 post-container"
      >
        <!-- Multi-Lingual -->
         <h1 id="入门">入门</h1>

<p>我们编写一下以下的案例：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"src/index.js"</span> <span class="na">type=</span><span class="s">"module"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c1">// src/index.js</span>

<span class="k">import</span> <span class="nx">addHeader</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./add-header.js</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">header</span> <span class="o">=</span> <span class="nx">addHeader</span><span class="p">();</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">header</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="c1">// src/add-header.js</span>
<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">addHeader</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">header</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">header</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">header</span><span class="dl">'</span><span class="p">;</span>
  <span class="nx">header</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">header</span><span class="dl">'</span><span class="p">));</span>
  <span class="k">return</span> <span class="nx">header</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>采用 es module 的方式来编写。现在越来越多的浏览器也支持 es module，而新出的 vite 也是觉得现在大环境下 es module 的主流浏览器已经都支持了，可以大规模使用了</p>

<p>但是还不支持的话，我们上面这段代码是会报错的，我们开始引入 webpack 的学习</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>yarn add webpack webpack-cli <span class="nt">-D</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>引入核心模块 webpack 和 命令行模块 webpack-cli</p>

<p>package.json 引入下面的命令</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"dev"</span><span class="p">:</span><span class="w"> </span><span class="s2">"webpack"</span><span class="w">
</span><span class="p">}</span><span class="err">,</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>什么都不做的情况下直接运行 <code class="language-plaintext highlighter-rouge">yarn dev</code> 能得到下面的结果</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>yarn dev
yarn run v1.22.4
<span class="nv">$ </span>webpack
asset main.js 198 bytes <span class="o">[</span>emitted] <span class="o">[</span>minimized] <span class="o">(</span>name: main<span class="o">)</span>
orphan modules 201 bytes <span class="o">[</span>orphan] 1 module
./src/index.js + 1 modules 305 bytes <span class="o">[</span>built] <span class="o">[</span>code generated]

WARNING <span class="k">in </span>configuration
The <span class="s1">'mode'</span> option has not been <span class="nb">set</span>, webpack will fallback to <span class="s1">'production'</span> <span class="k">for </span>this value.
Set <span class="s1">'mode'</span> option to <span class="s1">'development'</span> or <span class="s1">'production'</span> to <span class="nb">enable </span>defaults <span class="k">for </span>each environment.
You can also <span class="nb">set </span>it to <span class="s1">'none'</span> to disable any default behavior. Learn more: https://webpack.js.org/configuration/mode/

webpack 5.35.0 compiled with 1 warning <span class="k">in </span>247 ms
</pre></td></tr></tbody></table></code></pre></div></div>

<p>虽然有一些报错，但是最终得到了我们想要的文件 <code class="language-plaintext highlighter-rouge">dist/main.js</code></p>

<p>修改下 index.html 文件</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"dist/main.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>发现也是正常运行的，看下我们 main.js 的内容</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">e</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">e</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">header</span><span class="dl">'</span><span class="p">),</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">header</span><span class="dl">'</span><span class="p">)),</span>
      <span class="nx">e</span>
    <span class="p">);</span>
  <span class="p">})();</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
<span class="p">})();</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>不过显然使用的只是 webpack 默认的配置，项目中肯定需要很多定制化的配置，wepback 提供了 webpack.config.js 的默认配置文件，我们可以新建这么一个文件，去编写一些个性化配置</p>

<p>它返回的是一个模块化的配置对象，先配置一个简单的</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">entry</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/index.js</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">output</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">filename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">bundle.js</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">path</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">dist</span><span class="dl">'</span><span class="p">),</span>
  <span class="p">},</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>我们重新打包，这个时候输出的文件名是 bundle.js 了，所以 html 文件也做对应的改变就好了</p>

<p>我们接下来也把 mode 给加上</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">entry</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/index.js</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">output</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">filename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">bundle.js</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">path</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">dist</span><span class="dl">'</span><span class="p">),</span>
  <span class="p">},</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>得到下面的打包结果和打包文件</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>npx webpack
asset bundle.js 4.33 KiB <span class="o">[</span>emitted] <span class="o">(</span>name: main<span class="o">)</span>
runtime modules 670 bytes 3 modules
cacheable modules 305 bytes
  ./src/index.js 104 bytes <span class="o">[</span>built] <span class="o">[</span>code generated]
  ./src/add-header.js 201 bytes <span class="o">[</span>built] <span class="o">[</span>code generated]
webpack 5.35.0 compiled successfully <span class="k">in </span>111 ms
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
</pre></td><td class="rouge-code"><pre><span class="cm">/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */</span>
<span class="cm">/******/</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// webpackBootstrap</span>
  <span class="cm">/******/</span> <span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>
  <span class="cm">/******/</span> <span class="kd">var</span> <span class="nx">__webpack_modules__</span> <span class="o">=</span> <span class="p">{</span>
    <span class="cm">/***/</span> <span class="dl">'</span><span class="s1">./src/add-header.js</span><span class="dl">'</span><span class="p">:</span>
      <span class="cm">/*!***************************!*\
  !*** ./src/add-header.js ***!
  \***************************/</span>
      <span class="cm">/***/</span> <span class="p">(</span>
        <span class="nx">__unused_webpack_module</span><span class="p">,</span>
        <span class="nx">__webpack_exports__</span><span class="p">,</span>
        <span class="nx">__webpack_require__</span>
      <span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nb">eval</span><span class="p">(</span>
          <span class="dl">"</span><span class="s2">__webpack_require__.r(__webpack_exports__);</span><span class="se">\n</span><span class="s2">/* harmony export */ __webpack_require__.d(__webpack_exports__, {</span><span class="se">\n</span><span class="s2">/* harmony export */   </span><span class="se">\"</span><span class="s2">default</span><span class="se">\"</span><span class="s2">: () =&gt; (/* binding */ addHeader)</span><span class="se">\n</span><span class="s2">/* harmony export */ });</span><span class="se">\n</span><span class="s2">function addHeader() {</span><span class="se">\n</span><span class="s2">  const header = document.createElement('div');</span><span class="se">\n</span><span class="s2">  header.innerHTML = 'header';</span><span class="se">\n</span><span class="s2">  header.addEventListener('click', () =&gt; console.log('header'));</span><span class="se">\n</span><span class="s2">  return header;</span><span class="se">\n</span><span class="s2">}</span><span class="se">\n\n\n</span><span class="s2">//# sourceURL=webpack://demo-1/./src/add-header.js?</span><span class="dl">"</span>
        <span class="p">);</span>

        <span class="cm">/***/</span>
      <span class="p">},</span>

    <span class="cm">/***/</span> <span class="dl">'</span><span class="s1">./src/index.js</span><span class="dl">'</span><span class="p">:</span>
      <span class="cm">/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/</span>
      <span class="cm">/***/</span> <span class="p">(</span>
        <span class="nx">__unused_webpack_module</span><span class="p">,</span>
        <span class="nx">__webpack_exports__</span><span class="p">,</span>
        <span class="nx">__webpack_require__</span>
      <span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nb">eval</span><span class="p">(</span>
          <span class="dl">'</span><span class="s1">__webpack_require__.r(__webpack_exports__);</span><span class="se">\n</span><span class="s1">/* harmony import */ var _add_header_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./add-header.js */ "./src/add-header.js");</span><span class="se">\n\n</span><span class="s1">const header = (0,_add_header_js__WEBPACK_IMPORTED_MODULE_0__.default)();</span><span class="se">\n</span><span class="s1">document.body.appendChild(header);</span><span class="se">\n\n\n</span><span class="s1">//# sourceURL=webpack://demo-1/./src/index.js?</span><span class="dl">'</span>
        <span class="p">);</span>

        <span class="cm">/***/</span>
      <span class="p">},</span>

    <span class="cm">/******/</span>
  <span class="p">};</span> <span class="c1">// The module cache</span>
  <span class="cm">/************************************************************************/</span>
  <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="kd">var</span> <span class="nx">__webpack_module_cache__</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// The require function</span>
  <span class="cm">/******/</span>
  <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="kd">function</span> <span class="nx">__webpack_require__</span><span class="p">(</span><span class="nx">moduleId</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/******/</span> <span class="c1">// Check if module is in cache</span>
    <span class="cm">/******/</span> <span class="kd">var</span> <span class="nx">cachedModule</span> <span class="o">=</span> <span class="nx">__webpack_module_cache__</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">];</span>
    <span class="cm">/******/</span> <span class="k">if</span> <span class="p">(</span><span class="nx">cachedModule</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/******/</span> <span class="k">return</span> <span class="nx">cachedModule</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
      <span class="cm">/******/</span>
    <span class="p">}</span> <span class="c1">// Create a new module (and put it into the cache)</span>
    <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="p">(</span><span class="nx">__webpack_module_cache__</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="cm">/******/</span> <span class="c1">// no module.id needed</span>
      <span class="cm">/******/</span> <span class="c1">// no module.loaded needed</span>
      <span class="cm">/******/</span> <span class="na">exports</span><span class="p">:</span> <span class="p">{},</span>
      <span class="cm">/******/</span>
    <span class="p">});</span> <span class="c1">// Execute the module function</span>
    <span class="cm">/******/</span>
    <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="nx">__webpack_modules__</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">](</span>
      <span class="nx">module</span><span class="p">,</span>
      <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span>
      <span class="nx">__webpack_require__</span>
    <span class="p">);</span> <span class="c1">// Return the exports of the module</span>
    <span class="cm">/******/</span>
    <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="k">return</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
    <span class="cm">/******/</span>
  <span class="p">}</span> <span class="cm">/* webpack/runtime/define property getters */</span>
  <span class="cm">/******/</span>
  <span class="cm">/************************************************************************/</span>
  <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="cm">/******/</span> <span class="c1">// define getter functions for harmony exports</span>
    <span class="cm">/******/</span> <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">definition</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="cm">/******/</span> <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">definition</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/******/</span> <span class="k">if</span> <span class="p">(</span>
          <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">definition</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
          <span class="o">!</span><span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span>
        <span class="p">)</span> <span class="p">{</span>
          <span class="cm">/******/</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">enumerable</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="na">get</span><span class="p">:</span> <span class="nx">definition</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span>
          <span class="p">});</span>
          <span class="cm">/******/</span>
        <span class="p">}</span>
        <span class="cm">/******/</span>
      <span class="p">}</span>
      <span class="cm">/******/</span>
    <span class="p">};</span>
    <span class="cm">/******/</span>
  <span class="p">})();</span> <span class="cm">/* webpack/runtime/hasOwnProperty shorthand */</span>
  <span class="cm">/******/</span>
  <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="cm">/******/</span> <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">o</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">);</span>
    <span class="cm">/******/</span>
  <span class="p">})();</span> <span class="cm">/* webpack/runtime/make namespace object */</span>
  <span class="cm">/******/</span>
  <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="cm">/******/</span> <span class="c1">// define __esModule on exports</span>
    <span class="cm">/******/</span> <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">r</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exports</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="cm">/******/</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">Symbol</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">undefined</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nb">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/******/</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nb">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">,</span> <span class="p">{</span>
          <span class="na">value</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Module</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">});</span>
        <span class="cm">/******/</span>
      <span class="p">}</span>
      <span class="cm">/******/</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="dl">'</span><span class="s1">__esModule</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
      <span class="cm">/******/</span>
    <span class="p">};</span>
    <span class="cm">/******/</span>
  <span class="p">})();</span> <span class="c1">// startup // Load entry module and return exports // This entry module can't be inlined because the eval devtool is used.</span>
  <span class="cm">/******/</span>
  <span class="cm">/************************************************************************/</span>
  <span class="cm">/******/</span>
  <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="kd">var</span> <span class="nx">__webpack_exports__</span> <span class="o">=</span> <span class="nx">__webpack_require__</span><span class="p">(</span>
    <span class="dl">'</span><span class="s1">./src/index.js</span><span class="dl">'</span>
  <span class="p">);</span>
  <span class="cm">/******/</span>
  <span class="cm">/******/</span>
<span class="p">})();</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>我们尝试下把注释全部去掉，看看运行</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
</pre></td><td class="rouge-code"><pre><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="p">(</span><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">__webpack_modules__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">,</span>
    <span class="p">(</span><span class="nx">__unused_webpack_module</span><span class="p">,</span> <span class="nx">__webpack_exports__</span><span class="p">,</span> <span class="nx">__webpack_require__</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">r</span><span class="p">(</span><span class="nx">__webpack_exports__</span><span class="p">);</span>
      <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="nx">__webpack_exports__</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">default</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">addHeader</span><span class="p">,</span>
      <span class="p">});</span>
      <span class="kd">function</span> <span class="nx">addHeader</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">header</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">header</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">header</span><span class="dl">'</span><span class="p">;</span>
        <span class="nx">header</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">header</span><span class="dl">'</span><span class="p">));</span>
        <span class="k">return</span> <span class="nx">header</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>
  <span class="p">];</span>

  <span class="kd">var</span> <span class="nx">__webpack_module_cache__</span> <span class="o">=</span> <span class="p">{};</span>

  <span class="kd">function</span> <span class="nx">__webpack_require__</span><span class="p">(</span><span class="nx">moduleId</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">cachedModule</span> <span class="o">=</span> <span class="nx">__webpack_module_cache__</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">cachedModule</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">cachedModule</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="p">(</span><span class="nx">__webpack_module_cache__</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">exports</span><span class="p">:</span> <span class="p">{},</span>
    <span class="p">});</span>

    <span class="nx">__webpack_modules__</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">](</span><span class="nx">module</span><span class="p">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">__webpack_require__</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">definition</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">definition</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span>
          <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">definition</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
          <span class="o">!</span><span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span>
        <span class="p">)</span> <span class="p">{</span>
          <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">enumerable</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="na">get</span><span class="p">:</span> <span class="nx">definition</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span>
          <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">})();</span>

  <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">o</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">);</span>
  <span class="p">})();</span>

  <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">r</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exports</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">Symbol</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">undefined</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nb">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nb">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">,</span> <span class="p">{</span>
          <span class="na">value</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Module</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="dl">'</span><span class="s1">__esModule</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
    <span class="p">};</span>
  <span class="p">})();</span>

  <span class="kd">var</span> <span class="nx">__webpack_exports__</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">r</span><span class="p">(</span><span class="nx">__webpack_exports__</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">_add_header_js__WEBPACK_IMPORTED_MODULE_0__</span> <span class="o">=</span> <span class="nx">__webpack_require__</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="kd">const</span> <span class="nx">header</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">_add_header_js__WEBPACK_IMPORTED_MODULE_0__</span><span class="p">.</span><span class="k">default</span><span class="p">)();</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">header</span><span class="p">);</span>
  <span class="p">})();</span>
<span class="p">})();</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>根据浏览器的断点运行看看执行结果，对 webpack 的机制就大概懂了</p>

<p>尝试多引入一个模块，发现大体框架都不变的</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
</pre></td><td class="rouge-code"><pre><span class="cm">/******/</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// webpackBootstrap</span>
  <span class="cm">/******/</span> <span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>
  <span class="cm">/******/</span> <span class="kd">var</span> <span class="nx">__webpack_modules__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">,</span>
    <span class="cm">/* 0 */</span> <span class="cm">/* 1 */</span>
    <span class="cm">/***/</span> <span class="p">(</span>
      <span class="nx">__unused_webpack_module</span><span class="p">,</span>
      <span class="nx">__webpack_exports__</span><span class="p">,</span>
      <span class="nx">__webpack_require__</span>
    <span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">r</span><span class="p">(</span><span class="nx">__webpack_exports__</span><span class="p">);</span>
      <span class="cm">/* harmony export */</span> <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="nx">__webpack_exports__</span><span class="p">,</span> <span class="p">{</span>
        <span class="cm">/* harmony export */</span> <span class="na">default</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="cm">/* binding */</span> <span class="nx">addHeader</span><span class="p">,</span>
        <span class="cm">/* harmony export */</span>
      <span class="p">});</span>
      <span class="kd">function</span> <span class="nx">addHeader</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">header</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">header</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">header</span><span class="dl">'</span><span class="p">;</span>
        <span class="nx">header</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">header</span><span class="dl">'</span><span class="p">));</span>
        <span class="k">return</span> <span class="nx">header</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="cm">/***/</span>
    <span class="p">},</span>
    <span class="cm">/* 2 */</span>
    <span class="cm">/***/</span> <span class="p">(</span>
      <span class="nx">__unused_webpack_module</span><span class="p">,</span>
      <span class="nx">__webpack_exports__</span><span class="p">,</span>
      <span class="nx">__webpack_require__</span>
    <span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">r</span><span class="p">(</span><span class="nx">__webpack_exports__</span><span class="p">);</span>
      <span class="cm">/* harmony export */</span> <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="nx">__webpack_exports__</span><span class="p">,</span> <span class="p">{</span>
        <span class="cm">/* harmony export */</span> <span class="na">default</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="cm">/* binding */</span> <span class="nx">add</span><span class="p">,</span>
        <span class="cm">/* harmony export */</span>
      <span class="p">});</span>
      <span class="kd">function</span> <span class="nx">add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="cm">/***/</span>
    <span class="p">},</span>
    <span class="cm">/******/</span>
  <span class="p">];</span> <span class="c1">// The module cache</span>
  <span class="cm">/************************************************************************/</span>
  <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="kd">var</span> <span class="nx">__webpack_module_cache__</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// The require function</span>
  <span class="cm">/******/</span>
  <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="kd">function</span> <span class="nx">__webpack_require__</span><span class="p">(</span><span class="nx">moduleId</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/******/</span> <span class="c1">// Check if module is in cache</span>
    <span class="cm">/******/</span> <span class="kd">var</span> <span class="nx">cachedModule</span> <span class="o">=</span> <span class="nx">__webpack_module_cache__</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">];</span>
    <span class="cm">/******/</span> <span class="k">if</span> <span class="p">(</span><span class="nx">cachedModule</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/******/</span> <span class="k">return</span> <span class="nx">cachedModule</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
      <span class="cm">/******/</span>
    <span class="p">}</span> <span class="c1">// Create a new module (and put it into the cache)</span>
    <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="p">(</span><span class="nx">__webpack_module_cache__</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="cm">/******/</span> <span class="c1">// no module.id needed</span>
      <span class="cm">/******/</span> <span class="c1">// no module.loaded needed</span>
      <span class="cm">/******/</span> <span class="na">exports</span><span class="p">:</span> <span class="p">{},</span>
      <span class="cm">/******/</span>
    <span class="p">});</span> <span class="c1">// Execute the module function</span>
    <span class="cm">/******/</span>
    <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="nx">__webpack_modules__</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">](</span>
      <span class="nx">module</span><span class="p">,</span>
      <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span>
      <span class="nx">__webpack_require__</span>
    <span class="p">);</span> <span class="c1">// Return the exports of the module</span>
    <span class="cm">/******/</span>
    <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="k">return</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
    <span class="cm">/******/</span>
  <span class="p">}</span> <span class="cm">/* webpack/runtime/define property getters */</span>
  <span class="cm">/******/</span>
  <span class="cm">/************************************************************************/</span>
  <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="cm">/******/</span> <span class="c1">// define getter functions for harmony exports</span>
    <span class="cm">/******/</span> <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">definition</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="cm">/******/</span> <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">definition</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/******/</span> <span class="k">if</span> <span class="p">(</span>
          <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">definition</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
          <span class="o">!</span><span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span>
        <span class="p">)</span> <span class="p">{</span>
          <span class="cm">/******/</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">enumerable</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="na">get</span><span class="p">:</span> <span class="nx">definition</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span>
          <span class="p">});</span>
          <span class="cm">/******/</span>
        <span class="p">}</span>
        <span class="cm">/******/</span>
      <span class="p">}</span>
      <span class="cm">/******/</span>
    <span class="p">};</span>
    <span class="cm">/******/</span>
  <span class="p">})();</span> <span class="cm">/* webpack/runtime/hasOwnProperty shorthand */</span>
  <span class="cm">/******/</span>
  <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="cm">/******/</span> <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">o</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">);</span>
    <span class="cm">/******/</span>
  <span class="p">})();</span> <span class="cm">/* webpack/runtime/make namespace object */</span>
  <span class="cm">/******/</span>
  <span class="cm">/******/</span> <span class="cm">/******/</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="cm">/******/</span> <span class="c1">// define __esModule on exports</span>
    <span class="cm">/******/</span> <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">r</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exports</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="cm">/******/</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">Symbol</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">undefined</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nb">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/******/</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nb">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">,</span> <span class="p">{</span>
          <span class="na">value</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Module</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">});</span>
        <span class="cm">/******/</span>
      <span class="p">}</span>
      <span class="cm">/******/</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="dl">'</span><span class="s1">__esModule</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
      <span class="cm">/******/</span>
    <span class="p">};</span>
    <span class="cm">/******/</span>
  <span class="p">})();</span>
  <span class="cm">/******/</span>
  <span class="cm">/************************************************************************/</span>
  <span class="kd">var</span> <span class="nx">__webpack_exports__</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="c1">// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.</span>
  <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">__webpack_require__</span><span class="p">.</span><span class="nx">r</span><span class="p">(</span><span class="nx">__webpack_exports__</span><span class="p">);</span>
    <span class="cm">/* harmony import */</span> <span class="kd">var</span> <span class="nx">_add_header_js__WEBPACK_IMPORTED_MODULE_0__</span> <span class="o">=</span> <span class="nx">__webpack_require__</span><span class="p">(</span>
      <span class="mi">1</span>
    <span class="p">);</span>
    <span class="cm">/* harmony import */</span> <span class="kd">var</span> <span class="nx">_add_js__WEBPACK_IMPORTED_MODULE_1__</span> <span class="o">=</span> <span class="nx">__webpack_require__</span><span class="p">(</span>
      <span class="mi">2</span>
    <span class="p">);</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="nx">_add_js__WEBPACK_IMPORTED_MODULE_1__</span><span class="p">.</span><span class="k">default</span><span class="p">)(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">header</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">_add_header_js__WEBPACK_IMPORTED_MODULE_0__</span><span class="p">.</span><span class="k">default</span><span class="p">)();</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">header</span><span class="p">);</span>
  <span class="p">})();</span>

  <span class="cm">/******/</span>
<span class="p">})();</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="loader">loader</h1>

<p>也是才发现，入口文件不一定是 js 文件，也可以是 css 文件</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">entry</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/index.css</span><span class="dl">'</span><span class="p">,</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nt">body</span> <span class="p">{</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>但是会报错的</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>yarn dev
yarn run v1.22.4
<span class="nv">$ </span>webpack
asset main.js 1.46 KiB <span class="o">[</span>emitted] <span class="o">(</span>name: main<span class="o">)</span>
./src/index.css 23 bytes <span class="o">[</span>built] <span class="o">[</span>code generated] <span class="o">[</span>1 error]

ERROR <span class="k">in</span> ./src/index.css 1:5
Module parse failed: Unexpected token <span class="o">(</span>1:5<span class="o">)</span>
You may need an appropriate loader to handle this file <span class="nb">type</span>, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders
<span class="o">&gt;</span> body <span class="o">{</span>
|   width: 100%<span class="p">;</span>
| <span class="o">}</span>

webpack 5.35.1 compiled with 1 error <span class="k">in </span>80 ms
error Command failed with <span class="nb">exit </span>code 1.
info Visit https://yarnpkg.com/en/docs/cli/run <span class="k">for </span>documentation about this command.
</pre></td></tr></tbody></table></code></pre></div></div>

<p>这里我们开始去使用 loader，它的处理流程是</p>

<p>css -&gt; css-loader -&gt; webpack - bundle.js</p>

<p>我们先安装依赖</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>yarn add css-loader <span class="nt">-D</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>修改配置文件，mode 使用 none 的原因是方便看打包后的文件代码</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">entry</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/index.css</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">rules</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">css$/</span><span class="p">,</span>
        <span class="na">use</span><span class="p">:</span> <span class="dl">'</span><span class="s1">css-loader</span><span class="dl">'</span><span class="p">,</span>
      <span class="p">},</span>
    <span class="p">],</span>
  <span class="p">},</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>成功完成打包</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>yarn dev
yarn run v1.22.4
<span class="nv">$ </span>webpack
asset main.js 5.53 KiB <span class="o">[</span>emitted] <span class="o">(</span>name: main<span class="o">)</span>
runtime modules 937 bytes 4 modules
cacheable modules 1.88 KiB
  ./src/index.css 323 bytes <span class="o">[</span>built] <span class="o">[</span>code generated]
  ./node_modules/css-loader/dist/runtime/api.js 1.57 KiB <span class="o">[</span>built] <span class="o">[</span>code generated]
webpack 5.35.1 compiled successfully <span class="k">in </span>377 ms
</pre></td></tr></tbody></table></code></pre></div></div>

<p>如果在页面引入的话发现样式没有生效</p>

<p>通过源码可以发现只是定义了这个模块，加载到 js 代码中，但是没有去使用</p>

<p>我们需要再加上 style-loader 把 css-loader 产生的代码使用上</p>

<p>css -&gt; css-loader -&gt; style-loader -&gt; webpack - bundle.js</p>

<p>我们进行 <code class="language-plaintext highlighter-rouge">yarn add style-loader -D</code> 然后修改配置文件</p>

<p>这里需要注意的是， loader 配置里面的 use，loader 的顺序是倒序的</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">entry</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/index.css</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">rules</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">css$/</span><span class="p">,</span>
        <span class="na">use</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">style-loader</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">css-loader</span><span class="dl">'</span><span class="p">],</span>
      <span class="p">},</span>
    <span class="p">],</span>
  <span class="p">},</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>重新打包看看。此时发现我们的样式已经生效了</p>

<p>通过源码可以发现 style-loader 会把 css-loader 生成的代码，通过 创建 style 标签，添加到页面上</p>

<p>一般我们还是通过 js 文件作为入口文件，稍微调整下代码和配置文件</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="c1">// webpack.config.js</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">entry</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/index.js</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">rules</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">css$/</span><span class="p">,</span>
        <span class="na">use</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">style-loader</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">css-loader</span><span class="dl">'</span><span class="p">],</span>
      <span class="p">},</span>
    <span class="p">],</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="c1">// index.js</span>

<span class="k">import</span> <span class="dl">'</span><span class="s1">./index.css</span><span class="dl">'</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>这里想想为什么 要把 css 也打包进入 js 代码，不是应该分离吗？</p>

<p>其实想想如果有一个功能开发，我们在 html 代码里面引入 css 文件，然后开发 js 功能</p>

<p>但是后期可能不需要这个 js 模块功能了，我们移除 js 代码模块的同时还要去 html 代码中移除对应的 css 文件，同时维护两条线的成本是很高的</p>

<p>按照 webpack 的做法，所有资源都是 js 来控制，只需要维护我们的 js 代码就好了</p>

<h2 id="开发一个-loader">开发一个 loader</h2>

<p>any source -&gt; loader1 -&gt; loader2 -&gt; loader3 -&gt; javascript code</p>

<p>最后返回 js 代码</p>

<p>我们来开发一个简单的 markdown-loader</p>

<p>配置文件如下：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">entry</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/index.js</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">rules</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">css$/</span><span class="p">,</span>
        <span class="na">use</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">style-loader</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">css-loader</span><span class="dl">'</span><span class="p">],</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">md$/</span><span class="p">,</span>
        <span class="c1">// 不一定是模块名，也可以是路径</span>
        <span class="na">use</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">./markdown-loader</span><span class="dl">'</span><span class="p">],</span>
      <span class="p">},</span>
    <span class="p">],</span>
  <span class="p">},</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>看一下我们的 loader 文件，是不是很简单？</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">marked</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">marked</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">source</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">marked</span><span class="p">(</span><span class="nx">source</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="s2">`export default </span><span class="p">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">html</span><span class="p">)}</span><span class="s2">`</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">code</span><span class="p">;</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>loader 我们最终需要产生一段可执行的 js 代码，如上图</p>

<p>不过我们也可以进行一下变形，我们最终返回的是一段 html 字符串，然后交给下一个 loader 去处理</p>

<p>我们把我们的 loader 改成下面这样</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">marked</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">marked</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">source</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">marked</span><span class="p">(</span><span class="nx">source</span><span class="p">);</span>
  <span class="c1">// const code = `export default ${JSON.stringify(html)}`;</span>
  <span class="c1">// return code;</span>

  <span class="k">return</span> <span class="nx">html</span><span class="p">;</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>增加 html-loader：<code class="language-plaintext highlighter-rouge">yarn add html-loader -D</code></p>

<p>调整一下配置文件</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">entry</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/index.js</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">rules</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">css$/</span><span class="p">,</span>
        <span class="na">use</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">style-loader</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">css-loader</span><span class="dl">'</span><span class="p">],</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">md$/</span><span class="p">,</span>
        <span class="c1">// 不一定是模块名，也可以是路径</span>
        <span class="na">use</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">html-loader</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">./markdown-loader</span><span class="dl">'</span><span class="p">],</span>
      <span class="p">},</span>
    <span class="p">],</span>
  <span class="p">},</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>发现也是正常打包运行的</p>

<h2 id="总结">总结</h2>

<p>loader 机制是 webpack 核心机制</p>

<p>也因为 loader 的机制，整个社区可以添加新的 loader，加载任何资源</p>

<p>万物皆模块～</p>

<h1 id="插件">插件</h1>

<p>插件机制，主要是增加 webpack 在项目自动化构建方面的能力</p>

<p>loader 是各种资源加载的问题</p>

<p>plugins 是除了打包资源之外其他的构建能力</p>

<p>比如：</p>

<ul>
  <li>自动清除 dist 文件</li>
  <li>自动生成 html 文件</li>
  <li>根据环境为代码注入类似 api 这种地址可能变化的部门</li>
  <li>拷贝不需要参与打包的资源文件到指定输出目录</li>
  <li>压缩打包后的输出文件</li>
  <li>自动发布打包结果到服务器实现自动部署</li>
</ul>

<h2 id="插件使用">插件使用</h2>

<h3 id="目录清除">目录清除</h3>

<p><code class="language-plaintext highlighter-rouge">yarn add clean-webpack-plugin -D</code></p>

<p>修改配置文件</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">CleanWebpackPlugin</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">clean-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">output</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">filename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">main.js</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">path</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">dist</span><span class="dl">'</span><span class="p">),</span>
  <span class="p">},</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span><span class="k">new</span> <span class="nx">CleanWebpackPlugin</span><span class="p">()],</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>我们可以调整下输出文件的名字，然后重新打包，可以发现上次产生的文件已经被清除了</p>

<h3 id="自动生成-html-文件">自动生成 html 文件</h3>

<p><code class="language-plaintext highlighter-rouge">yarn add html-webpack-plugin -D</code></p>

<p>可以看看基本的一些配置：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="c1">// webpack.config.js</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">CleanWebpackPlugin</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">clean-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">html-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">output</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">filename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">main.js</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">path</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">dist</span><span class="dl">'</span><span class="p">),</span>
  <span class="p">},</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">CleanWebpackPlugin</span><span class="p">(),</span>
    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
      <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">webpack plugin sample</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">template</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/index.html</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">}),</span>
  <span class="p">],</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="c">&lt;!-- src/index.html --&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;&lt;</span><span class="err">%=</span> <span class="na">htmlWebpackPlugin.options.title</span> <span class="err">%</span><span class="nt">&gt;&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h1&gt;</span>结构<span class="nt">&lt;/h1&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"root"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>打包完之后的代码如下所示：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="c">&lt;!-- dist/index.html --&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>webpack plugin sample<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;script </span><span class="na">defer</span> <span class="na">src=</span><span class="s">"main.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h1&gt;</span>结构<span class="nt">&lt;/h1&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"root"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>如果向再生成更多的 html 文件，可以在 plugins 加入</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
  <span class="na">filename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">about.html</span><span class="dl">'</span><span class="p">,</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>不过这里暂时只是用了一个入口，所以 about.html 和 index.html 引用同一个 main.js 文件。我们可以使用多入口来处理</p>

<h3 id="文件复制">文件复制</h3>

<p>不需要参与构建的静态文件，比如 favicon robots.txt</p>

<p>可以放在根目录的 public / static 下</p>

<p>我们希望 webpack 打包的时候把这个目录下的文件都复制到输出目录，可以使用 copy-webpack-plugin</p>

<p><code class="language-plaintext highlighter-rouge">yarn add copy-webpack-plugin -D</code></p>

<p>简单的修改下配置</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">CleanWebpackPlugin</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">clean-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">html-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">CopyWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">copy-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">output</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">filename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">main.js</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">path</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">dist</span><span class="dl">'</span><span class="p">),</span>
  <span class="p">},</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">CleanWebpackPlugin</span><span class="p">(),</span>
    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
      <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">webpack plugin sample</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">template</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/index.html</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">}),</span>
    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
      <span class="na">filename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">about.html</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">}),</span>
    <span class="k">new</span> <span class="nx">CopyWebpackPlugin</span><span class="p">({</span>
      <span class="na">patterns</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1">// 需要拷贝的路径</span>
        <span class="p">{</span>
          <span class="na">from</span><span class="p">:</span> <span class="dl">'</span><span class="s1">public</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">to</span><span class="p">:</span> <span class="dl">'</span><span class="s1">public</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">],</span>
    <span class="p">}),</span>
  <span class="p">],</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="实现一个插件">实现一个插件</h2>

<p>每一个环节，都预留了一个钩子，我们可以在钩子上进行一些操作或者任务</p>

<p>合适的时机去做合适的事情，类似事件绑定</p>

<p>接下来我们开发移除注释的插件</p>

<p>webpack 要求插件返回的是一个函数，或者包含 apply 方法的类</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">CleanWebpackPlugin</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">clean-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">html-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">CopyWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">copy-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">RemoveCommentsPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./remove-comments-plugins</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">output</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">filename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">main.js</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">path</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">dist</span><span class="dl">'</span><span class="p">),</span>
  <span class="p">},</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">CleanWebpackPlugin</span><span class="p">(),</span>
    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
      <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">webpack plugin sample</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">template</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/index.html</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">}),</span>
    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
      <span class="na">filename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">about.html</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">}),</span>
    <span class="k">new</span> <span class="nx">CopyWebpackPlugin</span><span class="p">({</span>
      <span class="na">patterns</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1">// 需要拷贝的路径</span>
        <span class="p">{</span>
          <span class="na">from</span><span class="p">:</span> <span class="dl">'</span><span class="s1">public</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">to</span><span class="p">:</span> <span class="dl">'</span><span class="s1">public</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">],</span>
    <span class="p">}),</span>
    <span class="k">new</span> <span class="nx">RemoveCommentsPlugin</span><span class="p">(),</span>
  <span class="p">],</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">RemoveCommentsPlugin</span> <span class="p">{</span>
  <span class="nx">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// compiler 包含了此次构建的所有配置信息</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">remove comments plugin</span><span class="dl">'</span><span class="p">);</span>

    <span class="c1">// emit钩子 会在即将生成文件到输出目录之前执行</span>

    <span class="c1">// tap 方法注册钩子函数，第一个参数是插件名称，第二个是挂载到这个钩子上的函数</span>

    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">emit</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="dl">'</span><span class="s1">RemoveCommentsPlugin</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">compilation</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// compilation 此次打包上下文</span>
      <span class="c1">// compilation.assets 资源文件信息</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">compilation</span><span class="p">.</span><span class="nx">assets</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>

        <span class="c1">// 文件内容</span>
        <span class="c1">// console.log(compilation.assets[name].source());</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="dl">'</span><span class="s1">.js</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">contents</span> <span class="o">=</span> <span class="nx">compilation</span><span class="p">.</span><span class="nx">assets</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">source</span><span class="p">();</span>
          <span class="kd">const</span> <span class="nx">noComments</span> <span class="o">=</span> <span class="nx">contents</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\/\*{2,}\/\s?</span><span class="sr">/g</span><span class="p">,</span> <span class="dl">''</span><span class="p">);</span>
          <span class="nx">compilation</span><span class="p">.</span><span class="nx">assets</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">source</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">noComments</span><span class="p">,</span>
            <span class="na">size</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">noComments</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
          <span class="p">};</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">RemoveCommentsPlugin</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="运行机制和工作原理">运行机制和工作原理</h1>

<p>各种资源文件，在 webpack 中都是一个资源模块，通过 webpack 打包最终聚集在了一起</p>

<p>整个打包过程中</p>

<ul>
  <li>通过 loader 处理特殊资源都加载，比如加载样式，图片</li>
  <li>通过 plugin 实现各种自动化的构建任务，比如自动压缩，自动发布</li>
</ul>

<p>工作过程如下：</p>

<ul>
  <li>根据配置找到某一个文件作为入口，一般是 js 文件</li>
  <li>然后根据这个文件中的 import 或者 require 解析推断依赖的资源文件</li>
  <li>然后继续解析各个资源文件的依赖模块，不断递归下去，最终得到一个依赖关系树</li>
  <li>根据配置文件的 loader ，去加载模块</li>
  <li>把加载后的结果放入到 bundle.js 中，实现整个项目的打包</li>
</ul>

<p>一些图片和字体文件，无法用 js 来表示的，loader 会把它们单独作为资源文件拷贝到输出目录，然后把每个资源文件对应的路径作为模块的导出成员暴露给外部使用</p>

<p>插件机制不会影响核心打包过程。在每个环节预设了钩子，在这些钩子上可以加入我们的自定义的任务，完成我们想要做的事情</p>

<h2 id="查阅-webpack-源代码">查阅 webpack 源代码</h2>

<ol>
  <li>webpack cli 启动打包流程</li>
  <li>载入 webpack 模块，创建 complier 对象</li>
  <li>使用 complier 对象开始编译整个项目</li>
  <li>从入口文件开始，解析模块依赖，形成依赖树</li>
  <li>递归依赖树，每个模块交给对应的 loader 处理</li>
  <li>合并 loader 的处理完的结果，把打包结果输出到 dist 目录</li>
</ol>

<h3 id="webpack-cli">webpack cli</h3>

<p>webpack 可以通过其他方式使用，并不一定依赖于 webpack cli，所以它们也分离出来了两个爆</p>

<p>webpack cli 的作用是把 cli 的参数和 webpack 配置文件中的配置进行整合，得到一个完整的配置对象</p>

<p>然后载入 webpack 核心模块，传入配置对象，创建了 compiler 对象</p>

<p>options 还可以是一个数组，支持多路打包，不过我们一般是一个对象，单线打包</p>

<h3 id="compiler-对象">compiler 对象</h3>

<p>创建好 compiler 对象，开始注册了插件，因为从这里开始 webpack 的生命周期了，我们需要尽早的加载插件</p>

<p>这里也会判断监视模式，会去调用 webpack 的 watch 监视方法，如果没有的话，就开始调用 run 方法</p>

<p>这里会触发 beforeRun 和 run 的钩子函数</p>

<p>然后调用 compile 方法，真正的构建我们的项目</p>

<h3 id="开始构建">开始构建</h3>

<p>创建一个 newCompliation 对象，理解成构建过程中的上下文对象，包含了所以的资源信息和额外的信息，触发 make 钩子</p>

<h3 id="make-阶段">make 阶段</h3>

<p>根据 entry 入口模块，递归出所有的依赖，形成依赖树，递归每个模块交给不同的 loader 处理</p>

<p>具体流程是：</p>

<ul>
  <li>SingleEntryPlugin 调用了 Compilation 对象 addEntry，解析入口</li>
  <li>addEntry 方法中调用 <code class="language-plaintext highlighter-rouge">_addModuleChain</code> 方法，把入口模块添加到模块依赖列表</li>
  <li>Compilation 对象的 buildModule 方法进行模块构建</li>
  <li>buildModule 方法中执行具体的 loader，处理特殊资源的加载</li>
  <li>build 完成，使用 acorn 库生成对应代码的 ast 语法树</li>
  <li>根据语法树分析这个模块是否还有依赖的模块，如果有，循环 build 每个依赖</li>
  <li>所以依赖解析完成， build 阶段结束</li>
  <li>合并生成需要输出的 bundle.js 写到 dist 目录</li>
</ul>

<h1 id="dev-server-提高本地开发效率">Dev Server 提高本地开发效率</h1>

<p>我们虽然可以使用 <code class="language-plaintext highlighter-rouge">webpack --watch</code> 加上 <code class="language-plaintext highlighter-rouge">browsersync</code> 工具，实现</p>

<ul>
  <li>webpack 监听源代码，自动构建</li>
  <li>browsersync 监听 dist 代码，自动刷新浏览器</li>
</ul>

<p>但是多工具的使用，以及频繁磁盘读写，效率还是低下的</p>

<p>我们可以直接使用官方的 webpack-dev-server 工具</p>

<p><code class="language-plaintext highlighter-rouge">yarn add webpack-dev-server -D</code></p>

<p>执行 <code class="language-plaintext highlighter-rouge">yarn dev</code></p>

<p>注意，webpack5 从以前的 <code class="language-plaintext highlighter-rouge">webpack-dev-server</code> 命令变成了 <code class="language-plaintext highlighter-rouge">webpack serve</code> 命令</p>

<p>https://stackoverflow.com/questions/40379139/cannot-find-module-webpack-bin-config-yargs</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="w">  </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"dev"</span><span class="p">:</span><span class="w"> </span><span class="s2">"webpack serve"</span><span class="w">
  </span><span class="p">}</span><span class="err">,</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>我们就可以开启本地调试了</p>

<p>另外 webpack-dev-server 是会把构建的文件写到内存中，所以速度会快很多</p>

<p>可以先简单看一下我们的配置，主要注意里面的注释</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">html-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
      <span class="na">template</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/index.html</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">}),</span>
  <span class="p">],</span>
  <span class="na">devServer</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// 额外的静态资源路径，开发环境先不需要使用 copy-webpack-plugin</span>
    <span class="na">contentBase</span><span class="p">:</span> <span class="dl">'</span><span class="s1">public</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">proxy</span><span class="p">:</span> <span class="p">{</span>
      <span class="c1">// http://localhost:8080/api/users =&gt; https://api.github.com/users</span>
      <span class="dl">'</span><span class="s1">/api</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">target</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://api.github.com</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">pathRewrite</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">'</span><span class="s1">^/api</span><span class="dl">'</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span> <span class="c1">// 替换掉代理地址中的 /api</span>
        <span class="p">},</span>
        <span class="na">changeOrigin</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 确保请求 GitHub 的主机名是 api.github.com</span>
      <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="source-map">source map</h1>

<h2 id="前言">前言</h2>

<p>开启 source map</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">html-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">devtool</span><span class="p">:</span> <span class="dl">'</span><span class="s1">source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
      <span class="na">template</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/index.html</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">}),</span>
  <span class="p">],</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>还支持很多其他选项。我们先看看现在这种情况生成的代码</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="cm">/******/</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// webpackBootstrap</span>
  <span class="kd">var</span> <span class="nx">__webpack_exports__</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="cm">/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">demo</span><span class="dl">'</span><span class="p">);</span>

  <span class="cm">/******/</span>
<span class="p">})();</span>
<span class="c1">//# sourceMappingURL=main.js.map</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>我们的 dist/main.js 如上面的代码，最后指向了我们的 map 文件，它的内容如下：</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"webpack://demo-4/./src/index.js"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"names"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="nl">"mappings"</span><span class="p">:</span><span class="w"> </span><span class="s2">";;;;;AAAA"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"file"</span><span class="p">:</span><span class="w"> </span><span class="s2">"main.js"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sourcesContent"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"console.log('demo');</span><span class="se">\n</span><span class="s2">"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"sourceRoot"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="深入了解">深入了解</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">html-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">allModes</span> <span class="o">=</span> <span class="p">[</span>
  <span class="dl">'</span><span class="s1">eval</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">eval-cheap-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">eval-cheap-module-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">eval-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">cheap-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">cheap-module-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">inline-cheap-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">inline-cheap-module-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">inline-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">eval-nosources-cheap-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">eval-nosources-cheap-module-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">eval-nosources-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">inline-nosources-cheap-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">inline-nosources-cheap-module-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">inline-nosources-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">nosources-cheap-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">nosources-cheap-module-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">nosources-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">hidden-nosources-cheap-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">hidden-nosources-cheap-module-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">hidden-nosources-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">hidden-cheap-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">hidden-cheap-module-source-map</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">hidden-source-map</span><span class="dl">'</span><span class="p">,</span>
<span class="p">];</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">allModes</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">devtool</span><span class="p">:</span> <span class="nx">item</span><span class="p">,</span>
  <span class="na">output</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">filename</span><span class="p">:</span> <span class="s2">`js/</span><span class="p">${</span><span class="nx">item</span><span class="p">}</span><span class="s2">.js`</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
      <span class="na">template</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/index.html</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">filename</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">item</span><span class="p">}</span><span class="s2">.html`</span><span class="p">,</span>
    <span class="p">}),</span>
  <span class="p">],</span>
  <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">rules</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">js$/</span><span class="p">,</span>
        <span class="na">use</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">loader</span><span class="p">:</span> <span class="dl">'</span><span class="s1">babel-loader</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">options</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">presets</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">@babel/preset-env</span><span class="dl">'</span><span class="p">],</span>
          <span class="p">},</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">],</span>
  <span class="p">},</span>
<span class="p">}));</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>我们通过上面的配置文件，可以生成所有模式下打包出来的代码文件，然后再一个个来分析</p>

<p>不过也只是分析一些主要常用的</p>

<h3 id="eval">eval</h3>

<p>生成的代码通过 eval 来执行，也没有生成对应的 map 文件。只能定位文件，浏览器看到的也是经过 webpack 处理后的代码，而不是源代码</p>

<h3 id="eval-source-map">eval-source-map</h3>

<p>对比 eval 模式，它会生成 source map 信息，可以定位到源代码的位置。但是看到 source map 信息是在打包后的文件里面的</p>

<h3 id="eval-cheap-source-map">eval-cheap-source-map</h3>

<p>阉割版的 eval-source-map，只能定位到行，不能定位到列</p>

<p>构建速度快很多</p>

<h3 id="eval-cheap-module-source-map">eval-cheap-module-source-map</h3>

<p>名字带有 module 的模式，解析出来的源代码是没有经过 loader 处理的</p>

<p>名字不带 module 的模式，解析出来的是经过 loader 处理加工后的</p>

<p>所以看到我们加了 babel-loader</p>

<p>所以如果我们想要和源代码一模一样的话，就需要选择这种带有 module 的模式</p>

<h3 id="inline-source-map">inline-source-map</h3>

<p>和普通 source-map 效果一样，但是文件以 data urls 的形式存在，和上面的 eval-source-map 一样</p>

<h3 id="hide-source-map">hide-source-map</h3>

<p>开发工具看不到 source map 效果，但是确实生成了 source map 文件，代码没有引用</p>

<h3 id="nosources-source-map">nosources-source-map</h3>

<p>可以看到错误出现的位置，但是点进去看不到源代码</p>

<p>为了保护生产环节下不暴露源代码</p>

<h2 id="选择">选择</h2>

<p>开发环境选择 eval-cheap-module-source-map</p>

<ul>
  <li>选择框架比较多，loader 转化后的代码差异大，我们更希望调试 loader 转换前的</li>
  <li>不需要列的信息，有行信息就能比较好的定位到，省略列信息可以提升构建速度</li>
  <li>启动打包慢，但是配合 webpack-dev-server 都是在监视模式下重新打包，重新打包速度很快</li>
</ul>

<p>现网环境</p>

<ul>
  <li>最好不使用 source map 避免源代码的泄漏</li>
  <li>如果确实有需要，建议开启 nosources-source-map 模式，能定位到错误的地方，也能不暴露源码</li>
</ul>

<p>最后 webpack 和 source map 的关系，也只是 webpack 支持 source map，而不是 webpack 独有的功能</p>


        <hr style="visibility: hidden;" />
        <ul class="pager">
          
          <li class="previous">
            <a
              href="/Blog/2021/04/22/algo-1/"
              data-toggle="tooltip"
              data-placement="top"
              title="数据结构与算法 - 栈"
            >
              Previous<br />
              <span>数据结构与算法 - 栈</span>
            </a>
          </li>
           
          <li class="next">
            <a
              href="/Blog/2021/08/04/typescript-tutorial/"
              data-toggle="tooltip"
              data-placement="top"
              title="TypeScript Tutorial 中文版"
            >
              Next<br />
              <span>TypeScript Tutorial 中文版</span>
            </a>
          </li>
          
        </ul>
        <hr style="visibility: hidden;" />

        
        <!-- disqus 评论框 start -->
        <div class="comment">
          <div id="disqus_thread" class="disqus-thread"></div>
        </div>
        <!-- disqus 评论框 end -->
         
      </div>

      <!-- Side Catalog Container -->
      
      <div
        class="col-lg-2 col-lg-offset-0 visible-lg-block sidebar-container catalog-container"
      >
        <div class="side-catalog">
          <hr class="hidden-sm hidden-xs" />
          <h5>
            <a class="catalog-toggle" href="#">CATALOG</a>
          </h5>
          <ul class="catalog-body"></ul>
        </div>
      </div>
      

      <!-- Sidebar Container -->
      <div
        class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 sidebar-container"
      >
        <!-- Featured Tags -->
        


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/Blog/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        
        
        
                <a data-sort="0074" 
                    href="/Blog/archive/?tag=Regular"
                    title="Regular"
                    rel="4">Regular</a>
        
                <a data-sort="0038" 
                    href="/Blog/archive/?tag=LeetCode"
                    title="LeetCode"
                    rel="40">LeetCode</a>
        
                <a data-sort="0068" 
                    href="/Blog/archive/?tag=Process"
                    title="Process"
                    rel="10">Process</a>
        
                <a data-sort="0071" 
                    href="/Blog/archive/?tag=browser"
                    title="browser"
                    rel="7">browser</a>
        
                <a data-sort="0076" 
                    href="/Blog/archive/?tag=JavaScript"
                    title="JavaScript"
                    rel="2">JavaScript</a>
        
                <a data-sort="0076" 
                    href="/Blog/archive/?tag=Performance"
                    title="Performance"
                    rel="2">Performance</a>
        
                <a data-sort="0076" 
                    href="/Blog/archive/?tag=V8"
                    title="V8"
                    rel="2">V8</a>
        
                <a data-sort="0076" 
                    href="/Blog/archive/?tag=Vue"
                    title="Vue"
                    rel="2">Vue</a>
        
                <a data-sort="0076" 
                    href="/Blog/archive/?tag=life"
                    title="life"
                    rel="2">life</a>
    </div>
</section>


        <!-- Friends Blog -->
        
      </div>
    </div>
  </div>
</article>

<!-- add support for mathjax by voleking-->
  
<!-- disqus 公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES * * */
  var disqus_shortname = "cody1991-blog";
  var disqus_identifier = "/2021/04/24/webpack-demo";
  var disqus_url = "https://cody1991.github.io/Blog/2021/04/24/webpack-demo/";

  (function () {
    var dsq = document.createElement("script");
    dsq.type = "text/javascript";
    dsq.async = true;
    dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
    (
      document.getElementsByTagName("head")[0] ||
      document.getElementsByTagName("body")[0]
    ).appendChild(dsq);
  })();
</script>
<!-- disqus 公共JS代码 end -->
 
<!-- async load function -->
<script>
  function async(u, c) {
    var d = document,
      t = "script",
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener(
        "load",
        function (e) {
          c(null, e);
        },
        false
      );
    }
    s.parentNode.insertBefore(o, s);
  }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
  async(
    "//cdn.bootcdn.net/ajax/libs/anchor-js/1.1.1/anchor.min.js",
    function () {
      anchors.options = {
        visible: "hover",
        placement: "right",
        // icon: '#'
      };
      anchors
        .add()
        .remove(".intro-header h1")
        .remove(".subheading")
        .remove(".sidebar-container h5");
    }
  );
</script>
<style>
  /* place left on bigger screen */
  @media all and (min-width: 800px) {
    .anchorjs-link {
      position: absolute;
      left: -0.75em;
      font-size: 1.1em;
      margin-top: -0.1em;
    }
  }
</style>

 <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  
  <li>
    <a href="https://twitter.com/cody19910828">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="https://www.zhihu.com/people/cody1991">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa  fa-stack-1x fa-inverse">知</i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="http://weibo.com/cody1991">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="https://www.facebook.com/zexiong.tang">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="https://github.com/cody1991">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
</ul>

                <p class="copyright text-muted">
                    Copyright &copy; cody1991 2021
                    <br>
                    Powered by <a href="http://huangxuan.me">Hux Blog</a>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="//cdn.bootcdn.net/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="//cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/Blog/js/hux-blog.min.js "></script>

<!-- Simple Jekyll Search -->
<script src="//cdn.bootcdn.net/ajax/libs/simple-jekyll-search/1.7.12/simple-jekyll-search.min.js"></script>

<!-- Service Worker -->

<script src="/Blog/js/snackbar.js "></script>
<script src="/Blog/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->







<!--fastClick.js -->
<script>
    async("//cdn.bootcdn.net/ajax/libs/fastclick/1.0.6/fastclick.min.js", function () {
        var $nav = document.querySelector("nav");
        if ($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->



<!-- Baidu Tongji -->



<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog(selector) {

        // interop with multilangual 
        if ('' == 'true') {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("//cdn.bootcdn.net/ajax/libs/jquery-one-page-nav/3.0.0/jquery.nav.min.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->


<!-- Simple Jekyll Search -->
<script>
    // https://stackoverflow.com/questions/1912501/unescape-html-entities-in-javascript
    function htmlDecode(input) {
        var e = document.createElement('textarea');
        e.innerHTML = input;
        // handle case of empty input
        return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
    }

    SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('search-results'),
        json: '/Blog' + '/search.json',
        searchResultTemplate: '<div class="post-preview item"><a href="{url}"><h2 class="post-title">{title}</h2><h3 class="post-subtitle">{subtitle}</h3><hr></a></div>',
        noResultsText: 'No results',
        limit: 50,
        fuzzy: false,
        // a hack to get escaped subtitle unescaped. for some reason, 
        // post.subtitle w/o escape filter nuke entire search.
        templateMiddleware: function (prop, value, template) {
            if (prop === 'subtitle' || prop === 'title') {
                if (value.indexOf("code")) {
                    return htmlDecode(value);
                } else {
                    return value;
                }
            }
        }
    });

    $(document).ready(function () {
        var $searchPage = $('.search-page');
        var $searchOpen = $('.search-icon');
        var $searchClose = $('.search-icon-close');
        var $searchInput = $('#search-input');
        var $body = $('body');

        $searchOpen.on('click', function (e) {
            e.preventDefault();
            $searchPage.toggleClass('search-active');
            var prevClasses = $body.attr('class') || '';
            setTimeout(function () {
                $body.addClass('no-scroll');
            }, 400)

            if ($searchPage.hasClass('search-active')) {
                $searchClose.on('click', function (e) {
                    e.preventDefault();
                    $searchPage.removeClass('search-active');
                    $body.attr('class', prevClasses);  // from closure 
                });
                $searchInput.focus();
            }
        });
    });
</script>

    <!-- Image to hack wechat -->
    <img
      src="/Blog/img/icon_wechat.png"
      width="0"
      height="0"
    />
    <!-- Migrate from head to bottom, no longer block render and still work -->
  </body>
</html>
